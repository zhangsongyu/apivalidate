import com.alibaba.fastjson.JSON;
import com.api.validate.web.entity.FlattenKV;
import com.api.validate.web.util.MapUtil;
import com.api.validate.web.util.StringUtil;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.apache.commons.collections4.MapUtils;
import org.junit.Test;

import java.io.IOException;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collector;
import java.util.stream.Collectors;

public class APITest {


    @Test
    public void fullTest() throws IOException {
        //request:    "requestMapping": "/project/{projectId}/versionfs",
        String url = "/project/677/versions";

        Map requestBody = JSON.parseObject("{\"page\":{\"current\":1,\"size\":10,\"desc\":[\"updated_at\"]},\"jobStatus\":\"success\",\"projectVersion\":\"v\"}\n"
                , HashMap.class);
        Map swaggerValidate = new ObjectMapper().readValue("{  \"swaggerApi\": { \"projectName\": \"hahaproj\", \"title\": \"Swagger Maven Plugin Sample\", \"version\": \"v1\", \"description\": \"This is a sample for swagger-maven-plugin\", \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  \"paths\": [ {\"path\": {  \"projectName\": \"hahaproj\",  \"requestMapping\": \"/dictionary/{type}\",  \"requestMethod\": \"get\",  \"definition\": null,  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"params\": [  { \"projectName\": \"hahaproj\", \"bindType\": \"path\", \"requestMethod\": \"get\", \"requestMapping\": \"/dictionary/{type}\", \"paramName\": \"type\", \"paramType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }, {\"path\": {  \"projectName\": \"hahaproj\",  \"requestMapping\": \"/project/{projectId}/versionfs\",  \"requestMethod\": \"post\",  \"definition\": \"ProjectVersionsDTO\",  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"params\": [  { \"projectName\": \"hahaproj\", \"bindType\": \"path\", \"requestMethod\": \"post\", \"requestMapping\": \"/project/{projectId}/versionfs\", \"paramName\": \"projectId\", \"paramType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"bindType\": \"query\", \"requestMethod\": \"post\", \"requestMapping\": \"/project/{projectId}/versionfs\", \"paramName\": \"haha\", \"paramType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }, {\"path\": {  \"projectName\": \"hahaproj\",  \"requestMapping\": \"/project/get/{projectId}\",  \"requestMethod\": \"get\",  \"definition\": null,  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"params\": [  { \"projectName\": \"hahaproj\", \"bindType\": \"path\", \"requestMethod\": \"get\", \"requestMapping\": \"/project/get/{projectId}\", \"paramName\": \"projectId\", \"paramType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }, {\"path\": {  \"projectName\": \"hahaproj\",  \"requestMapping\": \"/project/{projectId}/versions\",  \"requestMethod\": \"post\",  \"definition\": \"ProjectVersionsDTO\",  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"params\": [  { \"projectName\": \"hahaproj\", \"bindType\": \"path\", \"requestMethod\": \"post\", \"requestMapping\": \"/project/{projectId}/versions\", \"paramName\": \"projectId\", \"paramType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }  ],  \"beans\": [ {\"bean\": {  \"beanName\": \"ProjectVersionsDTO\",  \"projectName\": \"hahaproj\",  \"beanType\": \"object\",  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"attrs\": [  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"downloadable\", \"attributeType\": \"booleana\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425049000, \"updateAt\": 1542425049000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"commitUser\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"updatedAt\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"startTime\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"ossUrl\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"accessLevel\", \"attributeType\": \"integer\", \"format\": \"int32\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"page\", \"attributeType\": null, \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": \"Page\", \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"jobStatus\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"downloadUrl\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"isExtendTime\", \"attributeType\": \"integer\", \"format\": \"int32\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"projectVersion\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"endTime\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"downloadable\", \"attributeType\": \"boolean\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"versionStatus\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectVersionsDTO\", \"attributeName\": \"commitSha\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }, {\"bean\": {  \"beanName\": \"R\",  \"projectName\": \"hahaproj\",  \"beanType\": \"object\",  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"attrs\": [  { \"projectName\": \"hahaproj\", \"beanName\": \"R\", \"attributeName\": \"success\", \"attributeType\": \"boolean\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"R\", \"attributeName\": \"size\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"R\", \"attributeName\": \"data\", \"attributeType\": \"object\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"R\", \"attributeName\": \"pages\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"R\", \"attributeName\": \"total\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"R\", \"attributeName\": \"errorCode\", \"attributeType\": \"integer\", \"format\": \"int32\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"R\", \"attributeName\": \"msg\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"R\", \"attributeName\": \"current\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }, {\"bean\": {  \"beanName\": \"AccountProject\",  \"projectName\": \"hahaproj\",  \"beanType\": \"object\",  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"attrs\": [  { \"projectName\": \"hahaproj\", \"beanName\": \"AccountProject\", \"attributeName\": \"id\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"AccountProject\", \"attributeName\": \"projectCode\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"AccountProject\", \"attributeName\": \"accountCode\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"AccountProject\", \"attributeName\": \"status\", \"attributeType\": \"boolean\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }, {\"bean\": {  \"beanName\": \"Page\",  \"projectName\": \"hahaproj\",  \"beanType\": \"object\",  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"attrs\": [  { \"projectName\": \"hahaproj\", \"beanName\": \"Page\", \"attributeName\": \"size\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Page\", \"attributeName\": \"pages\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Page\", \"attributeName\": \"total\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Page\", \"attributeName\": \"records\", \"attributeType\": \"array\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Page\", \"attributeName\": \"current\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }, {\"bean\": {  \"beanName\": \"ProjectDTO\",  \"projectName\": \"hahaproj\",  \"beanType\": \"object\",  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"attrs\": [  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"name\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"username\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"description\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"page\", \"attributeType\": null, \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": \"Page\", \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"componentCn\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"projectId\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"componentName\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"accountId\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"componentType\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"downloadable\", \"attributeType\": \"boolean\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"componentDescription\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"componentNewVersion\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"ProjectDTO\", \"attributeName\": \"componentEn\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }, {\"bean\": {  \"beanName\": \"Versions\",  \"projectName\": \"hahaproj\",  \"beanType\": \"object\",  \"createAt\": 1542425083000,  \"updateAt\": 1542425083000},\"attrs\": [  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"commitUser\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"updatedAt\", \"attributeType\": \"string\", \"format\": \"date-time\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"ossUrl\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"tag\", \"attributeType\": \"boolean\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"commitMsg\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"jobStatus\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"projectId\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"projectVersion\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"id\", \"attributeType\": \"integer\", \"format\": \"int64\", \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"downloadable\", \"attributeType\": \"boolean\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"versionStatus\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  },  { \"projectName\": \"hahaproj\", \"beanName\": \"Versions\", \"attributeName\": \"commitSha\", \"attributeType\": \"string\", \"format\": null, \"regular\": null, \"enable\": false, \"$ref\": null, \"createAt\": 1542425083000, \"updateAt\": 1542425083000  }] }  ]}", Map.class);

        List<Map<String, Map<String, Object>>> ss = (List<Map<String, Map<String, Object>>>) swaggerValidate.get("paths");
        String requestUrl = url;
        String method = "post";
        String beanName = ss.stream().filter(f ->
                StringUtil.urlMatch(requestUrl,
                        f.get("path").get("requestMapping").toString()) &&
                        f.get("path").get("requestMethod").toString().equals(method)).collect(Collectors.toList())
                .get(0)
                .get("path").get("definition").toString();
        String perfix = "";
        List res = MapUtil.flatten(requestBody, beanName);

        System.out.println(res);



    }
}
